# 总体设计

## 目的
设计一种新的 scrate 制品格式，方便分发、自我校验来源、完整性。

## 功能层次
分为若干版本实现。

### 参数结构

#### 1. 模式选择（--mode）
- `--mode net`：网络签名模式
- `--mode local`：本地签名模式（默认值，可省略）

#### 2. 配置文件（--config）
- `--config <path>`：指定配置文件路径
- 默认值：`config/config.toml`
- 当提供 `--config` 时，使用配置文件模式

#### 3. 本地模式子选项
本地模式（`--mode local`）必须选择以下选项之一：
- `--config`：使用配置文件模式，从配置文件中读取所有参数
- `--cli`：使用命令行参数模式，从命令行参数读取所有参数

**注意**：`--config` 和 `--cli` 不能同时使用，必须选择其一。

### 使用方式

#### 网络版本
```bash
# 网络模式，使用默认配置文件
cargo run -- -e --mode net --config

# 网络模式，使用自定义配置文件
cargo run -- -e --mode net --config my_net_config.toml
```

#### 本地版本（配置文件模式）
```bash
# 本地模式 + 配置文件，使用默认配置文件
cargo run -- -e --mode local --config
# 或简化写法（--mode local 是默认值）
cargo run -- -e --config

# 本地模式 + 配置文件，使用自定义配置文件
cargo run -- -e --config my_local_config.toml
```

#### 本地版本（命令行参数模式）
```bash
# 本地模式 + 命令行参数
cargo run -- -e --mode local --cli -c cert.pem -r root-ca.pem -p key.pem -o output/ input/
# 或简化写法
cargo run -- -e --cli -c cert.pem -r root-ca.pem -p key.pem -o output/ input/
```

### 版本区分总结

1. **--mode**：`net`/`local`（默认 `local`）。不提供 `--mode` 时默认使用 `local` 模式

2. **--config**：配置文件路径，默认是 `config/config.toml`
   - 网络模式：必须使用配置文件
   - 本地模式：与 `--cli` 二选一

3. **本地模式区分**：
   - `--config`：参数来源于配置文件
   - `--cli`：参数来源于命令行参数

### 本地完成签名的版本
采用本地存储的证书、密钥等完成功能的初步校验，细分为两个版本。

1. 从命令行读取参数（`--mode local --cli`）
2. 从配置文件读取参数（`--mode local --config`）

详细 [使用参考](本地签名版本使用说明.md)

### 网络签名版本
网络签名版本使用数字签名的基础设施的平台完成签名、验签的工作。

由于签名平台的能力在持续演进中，所以需要考虑多版本实现网络签名的能力。

具体设计网络见 [网络签名版本](网络签名版本%20.md)
